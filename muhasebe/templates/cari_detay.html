{% extends 'base_dashboard.html' %}

{% block title %}{{ cari.unvan }} - Detay{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3>{{ cari.unvan }}</h3>
                <span class="badge bg-primary">{{ cari.kod }}</span>
            </div>
            <div class="card-body">
                <!-- Temel Bilgiler -->
                <h5 class="text-primary mb-3">Temel Bilgiler</h5>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>Cari Tipi:</strong> {{ cari.get_tip_display }}</p>
                        <p><strong>Cari Grubu:</strong> {{ cari.grup|default:"-" }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Risk Limiti:</strong> {{ cari.risk_limiti|floatformat:2 }} ₺</p>
                        <p><strong>Bakiye:</strong> 
                            <span class="text-{{ cari.bakiye|yesno:'danger,success,muted' }}">
                                {{ cari.bakiye|floatformat:2 }} ₺
                            </span>
                        </p>
                    </div>
                </div>

                <!-- Yetkili Bilgileri -->
                <h5 class="text-primary mb-3">Yetkili Bilgileri</h5>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>Yetkili:</strong> {{ cari.yetkili_adi|default:"-" }}</p>
                        <p><strong>Telefon:</strong> {{ cari.telefon|default:"-" }}</p>
                        <p><strong>E-posta:</strong> {{ cari.email|default:"-" }}</p>
                    </div>
                    <div class="col-md-6">
                        {% if cari.yetkili_tel1 %}
                            <p><strong>Yetkili Tel 1:</strong> {{ cari.yetkili_tel1 }}</p>
                        {% endif %}
                        {% if cari.yetkili_tel2 %}
                            <p><strong>Yetkili Tel 2:</strong> {{ cari.yetkili_tel2 }}</p>
                        {% endif %}
                        {% if cari.yetkili_tel3 %}
                            <p><strong>Yetkili Tel 3:</strong> {{ cari.yetkili_tel3 }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Adres Bilgileri -->
                <h5 class="text-primary mb-3">Adres Bilgileri</h5>
                <div class="row mb-4">
                    <div class="col-md-12">
                        <p><strong>Adres:</strong> {{ cari.adres|default:"-" }}</p>
                        <p><strong>İl/İlçe:</strong> 
                            {% if cari.il %}
                                {{ cari.il.ad }}{% if cari.ilce %} / {{ cari.ilce.ad }}{% endif %}
                            {% else %}
                                -
                            {% endif %}
                        </p>
                    </div>
                </div>

                <!-- Fatura Bilgileri -->
                <h5 class="text-primary mb-3">Fatura Bilgileri</h5>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>Vergi No:</strong> {{ cari.vergi_no|default:"-" }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Vergi Dairesi:</strong> {{ cari.vergi_dairesi|default:"-" }}</p>
                    </div>
                </div>

                <!-- Bakiye Detayları -->
                <h5 class="text-primary mb-3">Bakiye Detayları</h5>
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Para Birimi</th>
                                        <th class="text-end">Toplam Giriş</th>
                                        <th class="text-end">Toplam Çıkış</th>
                                        <th class="text-end">Bakiye</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for bakiye in cari.get_bakiye_detay %}
                                    <tr>
                                        <td><strong>{{ bakiye.para_birimi__kod }} - {{ bakiye.para_birimi__ad }}</strong></td>
                                        <td class="text-end">{{ bakiye.toplam_giris|default:0|floatformat:2 }}</td>
                                        <td class="text-end">{{ bakiye.toplam_cikis|default:0|floatformat:2 }}</td>
                                        <td class="text-end {% if bakiye.bakiye > 0 %}text-success{% elif bakiye.bakiye < 0 %}text-danger{% endif %}">
                                            <strong>{{ bakiye.bakiye|floatformat:2 }}</strong>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">Henüz hareket bulunmamaktadır.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sistem Bilgileri -->
                <div class="row">
                    <div class="col-md-12">
                        <small class="text-muted">
                            Oluşturma: {{ cari.olusturma_tarihi|date:"d.m.Y H:i" }} | 
                            Son Güncelleme: {{ cari.guncelleme_tarihi|date:"d.m.Y H:i" }}
                        </small>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="d-flex justify-content-between">
                    <div>
                        <a href="{% url 'cari_list' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Geri
                        </a>
                        <a href="{% url 'cari_duzenle' cari.pk %}" class="btn btn-warning">
                            <i class="bi bi-pencil"></i> Düzenle
                        </a>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="if(confirm('Bu cari kartı silmek istediğinize emin misiniz?')) document.getElementById('deleteForm').submit();">
                            <i class="bi bi-trash"></i> Sil
                        </button>
                        <form id="deleteForm" method="post" action="{% url 'cari_sil' cari.pk %}" style="display: none;">
                            {% csrf_token %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}